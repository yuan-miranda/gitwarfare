<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Phaser Fight & Eat with Pause</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            background: #111;
        }

        canvas {
            display: block;
            margin: auto;
        }
    </style>
</head>

<body>
    <script>
        class MainScene extends Phaser.Scene {
            preload() {
                const gfx = this.make.graphics({ x: 0, y: 0, add: false });
                gfx.fillStyle(0xffffff, 1);
                gfx.fillRect(0, 0, 16, 16);
                gfx.generateTexture('px', 16, 16);
            }

            create() {
                this.score = 0;
                this.isPaused = false;

                // Player setup
                this.player = this.physics.add.image(320, 240, 'px').setTint(0x00ffcc);
                this.player.setCollideWorldBounds(true);
                this.player.setDamping(true).setDrag(500).setMaxVelocity(200);

                // Controls
                this.cursors = this.input.keyboard.createCursorKeys();
                this.keys = this.input.keyboard.addKeys('W,A,S,D');

                // Enemies
                this.enemies = this.physics.add.group({
                    key: 'px',
                    repeat: 100,
                    setXY: { x: 100, y: 100, stepX: 80 }
                });
                this.enemies.children.iterate((enemy) => {
                    enemy.setTint(0xff3366);
                    enemy.setBounce(1);
                    enemy.setCollideWorldBounds(true);
                    enemy.setVelocity(Phaser.Math.Between(-50, 50), Phaser.Math.Between(-50, 50));
                });

                // Particle system
                this.particleBurst = this.add.particles(0, 0, 'px', {
                    lifespan: 500,
                    speed: { min: -150, max: 150 },
                    scale: { start: 0.6, end: 0 },
                    alpha: { start: 1, end: 0 },
                    quantity: 20,
                    emitting: false
                });

                // Collision
                this.physics.add.overlap(this.player, this.enemies, this.eatEnemy, null, this);

                // Camera bounds
                this.cameras.main.setBounds(0, 0, 640, 480);

                // Pause overlay
                this.createPauseOverlay();

                // ESC key to toggle pause
                this.input.keyboard.on('keydown-ESC', () => {
                    this.togglePause();
                });

                // Resize handler
                this.scale.on('resize', this.resizeUI, this);
            }

            createPauseOverlay() {
                this.pauseOverlay = this.add.container(0, 0).setVisible(false);
                const bg = this.add.rectangle(320, 240, 640, 480, 0x000000, 0.6);
                const txt = this.add.text(320, 200, 'PAUSED', {
                    fontSize: '32px',
                    color: '#ffffff'
                }).setOrigin(0.5);

                const resumeBtn = this.add.text(320, 300, 'Resume', {
                    fontSize: '24px',
                    backgroundColor: '#00aa88',
                    padding: { x: 20, y: 10 },
                    color: '#ffffff'
                }).setOrigin(0.5).setInteractive();

                resumeBtn.on('pointerdown', () => this.togglePause());

                this.pauseOverlay.add([bg, txt, resumeBtn]);
            }

            resizeUI(gameSize) {
                const { width, height } = gameSize;
                if (!this.pauseOverlay) return;

                const bg = this.pauseOverlay.list[0];
                const txt = this.pauseOverlay.list[1];
                const resumeBtn = this.pauseOverlay.list[2];

                bg.setSize(width, height);
                bg.setPosition(width / 2, height / 2);
                txt.setPosition(width / 2, height / 2 - 40);
                resumeBtn.setPosition(width / 2, height / 2 + 60);
            }

            togglePause() {
                this.isPaused = !this.isPaused;
                this.pauseOverlay.setVisible(this.isPaused);
                if (this.isPaused) {
                    this.physics.pause();
                } else {
                    this.physics.resume();
                }
            }

            eatEnemy(player, enemy) {
                enemy.disableBody(true, true);
                this.cameras.main.shake(150, 0.01);
                this.particleBurst.explode(20, enemy.x, enemy.y);
                this.score++;
                player.setScale(1 + this.score * 0.1);
            }

            update() {
                if (this.isPaused) return;

                const speed = 300;
                let vx = 0, vy = 0;
                const left = this.cursors.left.isDown || this.keys.A.isDown;
                const right = this.cursors.right.isDown || this.keys.D.isDown;
                const up = this.cursors.up.isDown || this.keys.W.isDown;
                const down = this.cursors.down.isDown || this.keys.S.isDown;

                if (left) vx -= 1;
                if (right) vx += 1;
                if (up) vy -= 1;
                if (down) vy += 1;

                if (vx || vy) {
                    const len = Math.hypot(vx, vy);
                    this.player.setVelocity((vx / len) * speed, (vy / len) * speed);
                } else {
                    this.player.setVelocity(0, 0);
                }
            }
        }

        new Phaser.Game({
            type: Phaser.AUTO,
            backgroundColor: "#111",
            scale: {
                mode: Phaser.Scale.FIT,
                autoCenter: Phaser.Scale.CENTER_BOTH,
                width: 640,
                height: 480
            },
            physics: {
                default: 'arcade',
                arcade: { gravity: { y: 0 } }
            },
            scene: MainScene
        });
    </script>

</body>

</html>